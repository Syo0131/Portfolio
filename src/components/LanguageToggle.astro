---
import { Icon } from "astro-icon/components";
---

<button
  id="lang-toggle"
  class="group relative flex items-center gap-1.5 px-3 py-2 rounded-full bg-slate-900/80 backdrop-blur-lg text-slate-300 hover:text-shakespeare-400 transition-all duration-300 hover:scale-105 ring-1 ring-white/20 hover:ring-shakespeare-500/40 hover:shadow-lg hover:shadow-shakespeare-500/10"
  aria-label="Toggle language"
  title="Cambiar idioma / Change language"
>
  <Icon
    name="mdi:web"
    class="w-4 h-4 transition-transform duration-300 group-hover:rotate-12"
  />
  <span
    id="lang-text"
    class="text-xs font-semibold tracking-wider transition-all duration-300"
    >ES</span
  >
</button>

<script>
  function initLanguageToggle() {
    const langToggle = document.getElementById("lang-toggle");
    const langText = document.getElementById("lang-text");

    // Get current language from localStorage or default to 'es'
    let currentLang: string = localStorage.getItem("lang") || "es";

    // Update text on load
    updateLangText(currentLang);

    // Apply translations on load
    applyTranslations(currentLang);

    langToggle?.addEventListener("click", () => {
      currentLang = currentLang === "es" ? "en" : "es";
      localStorage.setItem("lang", currentLang);
      updateLangText(currentLang);
      applyTranslations(currentLang);
    });

    function updateLangText(lang: string): void {
      if (langText) {
        langText.textContent = lang === "es" ? "ES" : "EN";
      }
    }

    function applyTranslations(lang: string): void {
      // Update all elements with data-i18n attribute
      document.querySelectorAll("[data-i18n]").forEach((el) => {
        const key = el.getAttribute("data-i18n");
        if (key) {
          const translation = getTranslation(lang, key as string);
          if (translation) {
            el.textContent = translation;
          }
        }
      });

      // Update placeholders
      document.querySelectorAll("[data-i18n-placeholder]").forEach((el) => {
        const key = el.getAttribute("data-i18n-placeholder");
        if (
          key &&
          (el instanceof HTMLInputElement || el instanceof HTMLTextAreaElement)
        ) {
          const translation = getTranslation(lang, key as string);
          if (translation) {
            (el as HTMLInputElement | HTMLTextAreaElement).placeholder =
              translation;
          }
        }
      });

      // Update aria-labels
      document.querySelectorAll("[data-i18n-aria]").forEach((el) => {
        const key = el.getAttribute("data-i18n-aria");
        if (key) {
          const translation = getTranslation(lang, key as string);
          if (translation) {
            el.setAttribute("aria-label", translation);
          }
        }
      });

      // Update html lang attribute
      document.documentElement.lang = lang;
    }

    function getTranslation(lang: string, key: string): string | null {
      const translations: Record<string, Record<string, string>> = {
        es: {
          // Navigation
          "nav.home": "Inicio",
          "nav.experience": "Experiencia",
          "nav.projects": "Proyectos",
          "nav.skills": "Habilidades",
          "nav.contact": "Contacto",

          // Hero
          "hero.greeting": "Hey, Soy Daybel Diaz",
          "hero.experience": "+1 año de experiencia.",
          "hero.role": "Desarrollador Java",
          "hero.location": "de República Dominicana",
          "hero.description":
            "Especializado en crear soluciones escalables, desde la lógica de negocio hasta la integración final.",
          "hero.downloadCv": "Descargar CV",

          // Experience
          "experience.title": "Experiencia",
          "experience.helpdesk.position": "Soporte HelpDesk",
          "experience.helpdesk.period": "Marzo 2025 - Mayo 2025",
          "experience.helpdesk.type": "Contrato de formación",
          "experience.helpdesk.desc1":
            "Soporte a usuarios por mensaje y remotamente, resolución de incidencias técnicas.",
          "experience.helpdesk.desc2":
            "Revisión de equipos y verificación de errores de hardware y software.",
          "experience.java.position": "Java Analyst Developer",
          "experience.java.period": "Junio 2025 - Presente",
          "experience.java.type": "Jornada completa",
          "experience.java.desc1":
            "Desarrollo y mantenimiento de módulos Java para la gestión de usuarios y tarjetas de fidelidad.",
          "experience.java.desc2":
            "Implementación de funcionalidades para el procesamiento de facturas electrónicas y conciliación de transacciones.",

          // Projects
          "projects.title": "Proyectos",
          "projects.spendly.description":
            "Una aplicación web moderna desarrollada con Spring Boot y PostgreSQL para el control y seguimiento de gastos personales mensuales con una interfaz elegante y funcional.",
          "projects.portfolio.description":
            "Sitio web ultra rápido construido con Astro para mostrar mis habilidades y proyectos.",

          // Skills
          "skills.title": "Habilidades Técnicas",
          "skills.frontend": "Frontend",
          "skills.backend": "Backend",
          "skills.devops": "DevOps & Tools",

          // Certifications
          "certifications.title": "Certificaciones",
          "certifications.viewCert": "Ver Certificación",
          "certifications.inProgress": "En curso",
          "certifications.completed": "Completado",
          "certifications.comingSoon": "Próximamente",
          "certifications.spring.title":
            "Spring Framework 6 & Spring Boot 3 desde cero a experto",
          "certifications.spring.date": "Octubre 2025",
          "certifications.java.title":
            "Java avanzado: reactividad, concurrencia y patrones",
          "certifications.java.date": "Cursando",
          "certifications.python.title":
            "Python para principiantes - Aprende desde cero",
          "certifications.python.date": "Mayo 2024",
          "certifications.csharp.title":
            "Introducción a la programación con C#",
          "certifications.csharp.date": "Diciembre 2025",

          // Contact
          "contact.title": "¿Tienes algún proyecto en mente?",
          "contact.subtitle":
            "Completa el formulario y te responderé lo antes posible.",
          "contact.name": "Nombre",
          "contact.namePlaceholder": "Tu nombre completo",
          "contact.email": "Email",
          "contact.emailPlaceholder": "tu@email.com",
          "contact.message": "Mensaje",
          "contact.messagePlaceholder": "Cuéntame sobre tu proyecto o idea...",
          "contact.send": "Enviar mensaje",

          // Footer
          "footer.cta": "¿Listo para crear algo increíble juntos?",
          "footer.talk": "Hablemos",
          "footer.role": "Desarrollador Java • República Dominicana",
          "footer.available": "Disponible para nuevos proyectos",
          "footer.credit": "Diseñado y desarrollado con",
          "footer.using": "usando Astro & Tailwind CSS",
        },
        en: {
          // Navigation
          "nav.home": "Home",
          "nav.experience": "Experience",
          "nav.projects": "Projects",
          "nav.skills": "Skills",
          "nav.contact": "Contact",

          // Hero
          "hero.greeting": "Hey, I'm Daybel Diaz",
          "hero.experience": "+1 year of experience.",
          "hero.role": "Java Developer",
          "hero.location": "from Dominican Republic",
          "hero.description":
            "Specialized in creating scalable solutions, from business logic to final integration.",
          "hero.downloadCv": "Download CV",

          // Experience
          "experience.title": "Experience",
          "experience.helpdesk.position": "HelpDesk Support",
          "experience.helpdesk.period": "March 2025 - May 2025",
          "experience.helpdesk.type": "Training contract",
          "experience.helpdesk.desc1":
            "User support via messaging and remotely, technical incident resolution.",
          "experience.helpdesk.desc2":
            "Equipment review and verification of hardware and software errors.",
          "experience.java.position": "Java Analyst Developer",
          "experience.java.period": "June 2025 - Present",
          "experience.java.type": "Full-time",
          "experience.java.desc1":
            "Development and maintenance of Java modules for user management and loyalty cards.",
          "experience.java.desc2":
            "Implementation of functionalities for electronic invoice processing and transaction reconciliation.",

          // Projects
          "projects.title": "Projects",
          "projects.spendly.description":
            "A modern web application developed with Spring Boot and PostgreSQL for tracking and managing monthly personal expenses with an elegant and functional interface.",
          "projects.portfolio.description":
            "Ultra-fast website built with Astro to showcase my skills and projects.",

          // Skills
          "skills.title": "Technical Skills",
          "skills.frontend": "Frontend",
          "skills.backend": "Backend",
          "skills.devops": "DevOps & Tools",

          // Certifications
          "certifications.title": "Certifications",
          "certifications.viewCert": "View Certificate",
          "certifications.inProgress": "In progress",
          "certifications.completed": "Completed",
          "certifications.comingSoon": "Coming soon",
          "certifications.spring.title":
            "Spring Framework 6 & Spring Boot 3 from zero to expert",
          "certifications.spring.date": "October 2025",
          "certifications.java.title":
            "Advanced Java: reactivity, concurrency and patterns",
          "certifications.java.date": "In progress",
          "certifications.python.title":
            "Python for beginners - Learn from scratch",
          "certifications.python.date": "May 2024",
          "certifications.csharp.title": "Introduction to programming with C#",
          "certifications.csharp.date": "December 2025",

          // Contact
          "contact.title": "Have a project in mind?",
          "contact.subtitle":
            "Fill out the form and I'll get back to you as soon as possible.",
          "contact.name": "Name",
          "contact.namePlaceholder": "Your full name",
          "contact.email": "Email",
          "contact.emailPlaceholder": "you@email.com",
          "contact.message": "Message",
          "contact.messagePlaceholder": "Tell me about your project or idea...",
          "contact.send": "Send message",

          // Footer
          "footer.cta": "Ready to create something amazing together?",
          "footer.talk": "Let's talk",
          "footer.role": "Java Developer • Dominican Republic",
          "footer.available": "Available for new projects",
          "footer.credit": "Designed and developed with",
          "footer.using": "using Astro & Tailwind CSS",
        },
      };

      return translations[lang]?.[key] || null;
    }
  }

  // Initialize on DOMContentLoaded
  document.addEventListener("DOMContentLoaded", initLanguageToggle);

  // Also initialize on Astro page load (for view transitions)
  document.addEventListener("astro:page-load", initLanguageToggle);
</script>
