---
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";

interface Props {
  src: string;
  alt: string;
  class?: string;
  width?: number;
  height?: number;
  loading?: "lazy" | "eager";
  format?: "webp" | "avif" | "png" | "jpg";
  quality?: number;
}

const {
  src,
  alt,
  class: className,
  width,
  height,
  loading = "lazy",
  format = "webp",
  quality = 85,
} = Astro.props;

// Importar din√°micamente la imagen desde assets
const images = import.meta.glob<{ default: ImageMetadata }>(
  "/public/**/*.{png,jpg,jpeg,gif,webp,svg}"
);

// Construir la ruta completa
const imagePath = `/public/${src}`;
// Obtener la imagen
const imageModule = images[imagePath];

if (!imageModule) {
  throw new Error(
    `Image not found: ${src}. Make sure the image exists in src/public/`
  );
}

const imageSrc = (await imageModule()).default;
---

<Image
  src={imageSrc}
  alt={alt}
  width={width || imageSrc.width}
  height={height || imageSrc.height}
  loading={loading}
  class={className}
  format={format}
  quality={quality}
/>
