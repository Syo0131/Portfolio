---
import { Icon } from "astro-icon/components";
import SideBar from "../Headerbadge.astro";
import LanguageToggle from "../LanguageToggle.astro";
---

<!-- Language Toggle - Fixed top right for desktop -->
<div class="fixed top-5 right-4 lg:right-6 xl:right-8 z-[60] hidden lg:block">
  <LanguageToggle />
</div>

<aside
  id="main-sidebar"
  class="fixed right-2 sm:right-4 lg:right-6 xl:right-8 top-1/2 -translate-y-1/2 z-50 hidden lg:block"
  aria-label="Navegación lateral"
>
  <nav
    aria-label="Menú de escritorio"
    class="flex flex-col gap-1.5 sm:gap-2 rounded-full bg-slate-900/80 px-2.5 sm:px-3 py-3 sm:py-4 backdrop-blur-lg ring-1 ring-white/20 transition-all duration-300 ease-smooth-out hover:ring-shakespeare-500/30 hover:shadow-lg hover:shadow-shakespeare-500/10"
  >
    <SideBar
      href="#sobre-mi"
      name="Inicio"
      nameKey="nav.home"
      icon="mdi:home"
    />
    <SideBar
      href="#experiencia"
      name="Experiencia"
      nameKey="nav.experience"
      icon="mdi:briefcase"
    />
    <SideBar
      href="#proyectos"
      name="Proyectos"
      nameKey="nav.projects"
      icon="mdi:folder-multiple"
    />
    <SideBar
      href="#certifications"
      name="Certificaciones"
      nameKey="nav.certifications"
      icon="mdi:certificate-outline"
    />
    <SideBar
      href="#skills"
      name="Habilidades"
      nameKey="nav.skills"
      icon="mdi:code-braces"
    />
    <SideBar
      href="#contacto"
      name="Contacto"
      nameKey="nav.contact"
      icon="mdi:email"
    />
  </nav>
</aside>

<header
  class="fixed top-0 left-0 right-0 z-50 flex justify-center py-3 sm:py-4 px-3 sm:px-4 lg:hidden"
>
  <nav
    aria-label="Navegación principal móvil"
    class="flex items-center gap-0.5 sm:gap-2 md:gap-3 rounded-full bg-slate-900/90 px-1.5 sm:px-4 md:px-5 py-2 sm:py-2.5 backdrop-blur-lg ring-1 ring-white/20 shadow-lg"
  >
    <a
      href="#sobre-mi"
      aria-label="Ir a Inicio"
      class="nav-link hidden sm:block text-slate-100 hover:text-shakespeare-300 transition-all duration-300 px-1 sm:px-2 md:px-3 text-[11px] sm:text-sm hover:scale-105"
      data-i18n="nav.home"
      data-section="sobre-mi"
    >
      Inicio
    </a>
    <a
      href="#experiencia"
      aria-label="Ver Experiencia"
      class="nav-link text-slate-100 hover:text-shakespeare-300 transition-all duration-300 px-0.5 sm:px-2 md:px-3 text-[11px] sm:text-sm hover:scale-105"
      data-i18n="nav.experience"
      data-section="experiencia"
    >
      Experiencia
    </a>
    <a
      href="#proyectos"
      aria-label="Ver Proyectos"
      class="nav-link text-slate-100 hover:text-shakespeare-300 transition-all duration-300 px-0.5 sm:px-2 md:px-3 text-[11px] sm:text-sm hover:scale-105"
      data-i18n="nav.projects"
      data-section="proyectos"
    >
      Proyectos
    </a>
    <a
      href="#certifications"
      aria-label="Ver Certificaciones"
      class="nav-link text-slate-100 hover:text-shakespeare-300 transition-all duration-300 px-0.5 sm:px-2 md:px-3 text-[11px] sm:text-sm hover:scale-105"
      data-i18n="nav.certifications"
      data-section="certifications"
    >
      Certificaciones
    </a>
    <a
      href="#skills"
      aria-label="Ver Habilidades"
      class="nav-link text-slate-100 hover:text-shakespeare-300 transition-all duration-300 px-0.5 sm:px-2 md:px-3 text-[11px] sm:text-sm hover:scale-105"
      data-i18n="nav.skills"
      data-section="skills"
    >
      Habilidades
    </a>
    <a
      href="#contacto"
      aria-label="Ir a Contacto"
      class="nav-link text-slate-100 hover:text-shakespeare-300 transition-all duration-300 px-1.5 sm:px-2 md:px-3 text-[11px] sm:text-sm hover:scale-105"
      data-i18n="nav.contact"
      data-section="contacto"
    >
      Contacto
    </a>
    <LanguageToggle />
  </nav>
</header>

<script>
  function initActiveSection() {
    const sections = document.querySelectorAll("section[id]");
    const navLinks = document.querySelectorAll(".nav-link");

    console.log("Sections found:", sections.length);
    console.log("Nav links found:", navLinks.length);

    if (sections.length === 0 || navLinks.length === 0) {
      console.warn("No sections or nav links found");
      return;
    }

    // Configurar Intersection Observer
    const observerOptions = {
      root: null,
      rootMargin: "-10% 0px -50% 0px",
      threshold: 0.1,
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const sectionId = entry.target.id;
          console.log("Section active:", sectionId);

          // Remover clase activa de todos los links
          navLinks.forEach((link) => {
            const linkSection = link.getAttribute("data-section");
            if (linkSection === sectionId) {
              link.classList.add("active");
              console.log("Added active class to:", link);
            } else {
              link.classList.remove("active");
            }
          });
        }
      });
    }, observerOptions);

    // Observar todas las secciones
    sections.forEach((section) => {
      observer.observe(section);
      console.log("Observing section:", section.id);
    });
  }

  // Inicializar en carga del DOM
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initActiveSection);
  } else {
    initActiveSection();
  }

  // Reinicializar en navegación de Astro (si usas view transitions)
  document.addEventListener("astro:page-load", initActiveSection);
</script>

<style is:global>
  /* Estilos para nav links activos - móvil */
  header .nav-link.active {
    color: #5eb3e4 !important;
    font-weight: 700 !important;
    transform: scale(1.08) !important;
  }

  /* Estilos para nav links activos - desktop sidebar */
  aside .nav-link.active {
    color: #20cef0 !important;
    background-color: rgba(94, 179, 228, 0.15) !important;
    box-shadow: 0 0 0 1px rgba(94, 179, 228, 0.4) !important;
    transform: scale(1.1) !important;
  }
</style>
